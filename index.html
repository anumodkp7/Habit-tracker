<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>My Habit System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      --bg: #0f172a;
      --bg-soft: #111827;
      --card: #020617;
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.1);
      --accent-strong: #0ea5e9;
      --border: #1f2937;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --danger: #f97373;
      --success: #4ade80;
      --radius-lg: 18px;
      --radius-md: 10px;
      --shadow-soft: 0 20px 45px rgba(0,0,0,0.45);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      background: radial-gradient(circle at top, #1f2937 0, #020617 55%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 16px;
    }

    .app-shell {
      width: 100%;
      max-width: 1200px;
      background: linear-gradient(135deg, rgba(15,23,42,0.96), rgba(15,23,42,0.98));
      border-radius: 24px;
      border: 1px solid #1f2937;
      box-shadow: var(--shadow-soft);
      padding: 20px 22px 24px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .app-title { display: flex; flex-direction: column; gap: 4px; }

    .app-title h1 {
      margin: 0;
      font-size: 1.4rem;
      letter-spacing: 0.04em;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .chip {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      color: var(--muted);
    }

    .app-title p {
      margin: 0;
      font-size: 0.8rem;
      color: var(--muted);
    }

    .header-right {
      display: flex;
      flex-direction: column;
      gap: 6px;
      align-items: flex-end;
    }

    .date-picker {
      display: flex;
      gap: 8px;
      align-items: center;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      border: 1px solid var(--border);
    }

    .date-picker input[type="date"] {
      background: transparent;
      border: none;
      color: var(--text);
      font-size: 0.8rem;
      outline: none;
    }

    .streak-summary {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .streak-badge {
      font-size: 0.72rem;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,0.9);
      color: var(--muted);
    }

    .streak-badge.good {
      border-color: rgba(74,222,128,0.9);
      color: var(--success);
    }

    main {
      display: grid;
      grid-template-columns: minmax(0, 0.9fr) minmax(0, 1.1fr);
      gap: 16px;
    }

    @media (max-width: 960px) {
      main { grid-template-columns: 1fr; }
      .header-right { align-items: flex-start; }
    }

    .card {
      background: radial-gradient(circle at top left, rgba(56,189,248,0.08), transparent 55%),
                  radial-gradient(circle at bottom right, rgba(59,130,246,0.08), transparent 55%),
                  var(--card);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(31,41,55,0.9);
      padding: 16px 16px 14px;
      display: flex;
      flex-direction: column;
      gap: 14px;
      position: relative;
      overflow: hidden;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
    }

    .card-title {
      font-size: 0.95rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .card-subtitle {
      font-size: 0.75rem;
      color: var(--muted);
    }

    .pill {
      font-size: 0.7rem;
      padding: 2px 7px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent-strong);
      border: 1px solid rgba(56,189,248,0.35);
    }

    .section-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.13em;
      color: var(--muted);
    }

    .habit-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 360px;
      overflow: auto;
      padding-right: 4px;
    }

    .habit-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 8px 10px;
      border-radius: var(--radius-md);
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(31,41,55,0.9);
    }

    .habit-main {
      display: flex;
      align-items: center;
      gap: 8px;
      min-width: 0;
    }

    .habit-color {
      width: 6px;
      height: 32px;
      border-radius: 999px;
      background: linear-gradient(180deg, #38bdf8, #4ade80);
      opacity: 0.85;
    }

    .habit-name {
      font-size: 0.85rem;
      font-weight: 500;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    .habit-meta {
      font-size: 0.7rem;
      color: var(--muted);
    }

    .habit-actions {
      display: flex;
      gap: 4px;
      align-items: center;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 0.75rem;
      cursor: pointer;
      background: var(--accent-soft);
      color: var(--accent-strong);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    button.secondary {
      background: rgba(15,23,42,0.9);
      color: var(--muted);
      border: 1px solid rgba(55,65,81,0.9);
    }

    button.danger {
      background: rgba(239,68,68,0.15);
      color: var(--danger);
      border: 1px solid rgba(248,113,113,0.4);
    }

    button.small { padding: 4px 8px; font-size: 0.7rem; }

    .add-habit-form {
      display: flex;
      gap: 8px;
      margin-top: 4px;
      flex-wrap: wrap;
    }

    .add-habit-form input {
      flex: 1 1 160px;
      min-width: 0;
      padding: 7px 9px;
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,0.9);
      background: rgba(15,23,42,0.95);
      color: var(--text);
      font-size: 0.8rem;
      outline: none;
    }

    .add-habit-form input::placeholder { color: var(--muted); }

    .today-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 240px;
      overflow: auto;
      padding-right: 4px;
    }

    .today-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 7px 10px;
      border-radius: var(--radius-md);
      background: rgba(15,23,42,0.85);
      border: 1px solid rgba(31,41,55,0.9);
    }

    .today-main {
      display: flex;
      align-items: center;
      gap: 8px;
      min-width: 0;
    }

    .today-main label {
      font-size: 0.85rem;
      cursor: pointer;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .today-main input[type="checkbox"] {
      width: 16px;
      height: 16px;
      accent-color: var(--accent);
      cursor: pointer;
    }

    .today-status {
      font-size: 0.7rem;
      color: var(--muted);
    }

    .progress-ring {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .progress-circle-wrapper {
      position: relative;
      width: 64px;
      height: 64px;
    }

    .progress-circle-wrapper svg { transform: rotate(-90deg); }

    .progress-circle-wrapper .progress-text {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
    }

    .progress-summary {
      font-size: 0.78rem;
      color: var(--muted);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .badge-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .badge {
      font-size: 0.7rem;
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,0.9);
      color: var(--muted);
    }

    .badge.good {
      border-color: rgba(74,222,128,0.7);
      color: var(--success);
    }

    .history {
      margin-top: 4px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 0.7rem;
    }

    .history-row {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      padding: 4px 0;
      border-bottom: 1px dashed rgba(31,41,55,0.7);
    }

    .history-row:last-child { border-bottom: none; }

    .muted { color: var(--muted); }

    .week-section {
      margin-top: 4px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 0.7rem;
    }

    .week-strip {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .week-dot {
      min-width: 32px;
      padding: 3px 6px;
      border-radius: 999px;
      font-size: 0.68rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
      border: 1px solid rgba(55,65,81,0.9);
      background: rgba(15,23,42,0.9);
    }

    .week-dot span.percent { font-size: 0.62rem; }

    .week-low {
      background: rgba(248,113,113,0.15);
      border-color: rgba(248,113,113,0.7);
    }

    .week-mid {
      background: rgba(234,179,8,0.12);
      border-color: rgba(234,179,8,0.7);
    }

    .week-high {
      background: rgba(74,222,128,0.18);
      border-color: rgba(74,222,128,0.9);
    }

    .schedule-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 0.75rem;
      max-height: 180px;
      overflow: auto;
      padding-right: 4px;
    }

    .schedule-row {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      padding: 6px 8px;
      border-radius: var(--radius-md);
      background: rgba(15,23,42,0.85);
      border: 1px dashed rgba(31,41,55,0.8);
    }

    .schedule-time { color: var(--muted); min-width: 110px; }

    .schedule-task { font-weight: 500; }

    footer {
      font-size: 0.7rem;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      border-top: 1px solid rgba(31,41,55,0.9);
      padding-top: 8px;
      margin-top: -2px;
      flex-wrap: wrap;
    }

    footer button { font-size: 0.7rem; padding: 4px 9px; }
  </style>
</head>
<body>
  <div class="app-shell">
    <header>
      <div class="app-title">
        <div style="display:flex;align-items:center;gap:8px;">
          <h1>Habit System</h1>
          <span class="chip">Personal OS</span>
        </div>
        <p>Daily habits + fixed schedule + streaks — all in one place.</p>
      </div>

      <div class="header-right">
        <div class="date-picker">
          <span class="section-label">Day</span>
          <input type="date" id="dateInput" />
        </div>
        <div class="streak-summary">
          <span class="streak-badge" id="currentStreakBadge">Current streak: 0 days</span>
          <span class="streak-badge" id="bestStreakBadge">Best streak: 0 days</span>
        </div>
      </div>
    </header>

    <main>
      <!-- Left: Habits configuration + schedule -->
      <section class="card">
        <div class="card-header">
          <div>
            <div class="card-title">Habits</div>
            <div class="card-subtitle">Add, rename or remove the habits you want to track.</div>
          </div>
          <span class="pill" id="habitCountPill">0 habits</span>
        </div>

        <div class="habit-list" id="habitList"></div>

        <form class="add-habit-form" id="addHabitForm">
          <input
            type="text"
            id="habitNameInput"
            placeholder="Add new habit (e.g. Skill development)"
            autocomplete="off"
          />
          <button type="submit">+ Add</button>
        </form>

        <div>
          <div class="section-label" style="margin-top:8px;">Daily schedule (reference)</div>
          <div class="card-subtitle" style="margin-bottom:4px;">
            Your ideal weekday blocks — use this as a guide while checking off habits.
          </div>
          <div class="schedule-list" id="scheduleList"></div>
        </div>
      </section>

      <!-- Right: Today tracking & weekly view -->
      <section class="card">
        <div class="card-header">
          <div>
            <div class="card-title">Today’s Checklist</div>
            <div class="card-subtitle" id="todaySubtitle">Mark what you completed today.</div>
          </div>
          <div class="progress-ring">
            <div class="progress-circle-wrapper">
              <svg width="64" height="64">
                <circle
                  cx="32"
                  cy="32"
                  r="26"
                  stroke="rgba(55,65,81,0.9)"
                  stroke-width="6"
                  fill="none"
                ></circle>
                <circle
                  id="progressCircle"
                  cx="32"
                  cy="32"
                  r="26"
                  stroke="url(#grad)"
                  stroke-width="6"
                  fill="none"
                  stroke-linecap="round"
                  stroke-dasharray="163.36"
                  stroke-dashoffset="163.36"
                ></circle>
                <defs>
                  <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" stop-color="#38bdf8" />
                    <stop offset="100%" stop-color="#4ade80" />
                  </linearGradient>
                </defs>
              </svg>
              <div class="progress-text" id="progressText">0%</div>
            </div>
            <div class="progress-summary">
              <span id="progressHeadline">No habits completed yet.</span>
              <span id="progressDetail" class="muted">Tick items as you finish them.</span>
              <div class="badge-row">
                <span class="badge" id="badgeHabits">0 habits</span>
                <span class="badge" id="badgeCompleted">0 done</span>
                <span class="badge" id="badgePending">0 pending</span>
              </div>
            </div>
          </div>
        </div>

        <div class="today-list" id="todayList"></div>

        <div class="week-section">
          <div class="section-label">Last 7 days</div>
          <div class="week-strip" id="weekStrip"></div>
        </div>

        <div class="history" id="historySection">
          <div class="section-label">Recent log</div>
          <div id="historyList"></div>
        </div>
      </section>
    </main>

    <footer>
      <span>Tip: streak = days with all habits completed. Even one missed day resets it.</span>
      <button class="secondary small" id="resetDataBtn" title="This clears everything.">
        Reset all data
      </button>
    </footer>
  </div>

  <script>
    // --- Storage Keys ---
    const STORAGE_KEY_HABITS = "habitTrackerHabits_v2";
    const STORAGE_KEY_DATA = "habitTrackerData_v2";

    // --- Default habits (you can edit names) ---
    function loadHabits() {
      const saved = localStorage.getItem(STORAGE_KEY_HABITS);
      if (saved) {
        try {
          const parsed = JSON.parse(saved);
          if (Array.isArray(parsed)) return parsed;
        } catch (e) {}
      }

      return [
        { id: "skill", name: "Skill development" },
        { id: "excel", name: "Excel practice" },
        { id: "forex", name: "Forex learning" },
        { id: "nism", name: "NISM study" },
        { id: "read", name: "Reading" },
        { id: "yt", name: "YouTube / Idea panel" },
        { id: "pray", name: "Prayer" },
        { id: "meditation", name: "Meditation / Scripting" },
        { id: "brain", name: "Brain challenge" },
        { id: "workout", name: "Workout" }
      ];
    }

    function saveHabits(habits) {
      localStorage.setItem(STORAGE_KEY_HABITS, JSON.stringify(habits));
    }

    function loadData() {
      const saved = localStorage.getItem(STORAGE_KEY_DATA);
      if (saved) {
        try {
          const parsed = JSON.parse(saved);
          if (parsed && typeof parsed === "object") return parsed;
        } catch (e) {}
      }
      return {};
    }

    function saveData(data) {
      localStorage.setItem(STORAGE_KEY_DATA, JSON.stringify(data));
    }

    // --- State ---
    let habits = loadHabits();
    let data = loadData(); // { [date]: { [habitId]: true/false } }
    let currentDate = new Date();

    // --- DOM Elements ---
    const dateInput = document.getElementById("dateInput");
    const habitListEl = document.getElementById("habitList");
    const habitCountPill = document.getElementById("habitCountPill");
    const addHabitForm = document.getElementById("addHabitForm");
    const habitNameInput = document.getElementById("habitNameInput");

    const todayListEl = document.getElementById("todayList");
    const todaySubtitleEl = document.getElementById("todaySubtitle");

    const progressCircle = document.getElementById("progressCircle");
    const progressText = document.getElementById("progressText");
    const progressHeadline = document.getElementById("progressHeadline");
    const progressDetail = document.getElementById("progressDetail");
    const badgeHabits = document.getElementById("badgeHabits");
    const badgeCompleted = document.getElementById("badgeCompleted");
    const badgePending = document.getElementById("badgePending");

    const historyListEl = document.getElementById("historyList");
    const weekStripEl = document.getElementById("weekStrip");
    const resetDataBtn = document.getElementById("resetDataBtn");

    const currentStreakBadge = document.getElementById("currentStreakBadge");
    const bestStreakBadge = document.getElementById("bestStreakBadge");
    const scheduleListEl = document.getElementById("scheduleList");

    // --- Helpers ---
    function formatDateKey(date) {
      const d = new Date(date.getTime());
      const year = d.getFullYear();
      const month = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      return `${year}-${month}-${day}`;
    }

    function formatDateLabel(date) {
      return date.toLocaleDateString(undefined, {
        weekday: "short",
        month: "short",
        day: "numeric"
      });
    }

    function isToday(date) {
      const now = new Date();
      return (
        date.getFullYear() === now.getFullYear() &&
        date.getMonth() === now.getMonth() &&
        date.getDate() === now.getDate()
      );
    }

    // --- Schedule (your weekday blocks) ---
    const scheduleBlocks = [
      { time: "6:00 – 6:10 am", text: "Brush & Toilet" },
      { time: "6:10 – 6:35 am", text: "Workout", habitId: "workout" },
      { time: "6:35 – 7:15 am", text: "Bath + Breakfast" },
      { time: "7:15 – 7:50 am", text: "Brain challenge", habitId: "brain" },
      { time: "7:50 – 8:30 am", text: "Extra buffer / Breakfast" },
      { time: "8:30 – 9:00 am", text: "Office" },
      { time: "7:00 – 7:30 pm", text: "Skill development", habitId: "skill" },
      { time: "7:30 – 7:55 pm", text: "Excel", habitId: "excel" },
      { time: "7:55 – 8:05 pm", text: "Forex", habitId: "forex" },
      { time: "8:00 – 8:30 pm", text: "NISM certification", habitId: "nism" },
      { time: "8:30 – 9:00 pm", text: "Dinner" },
      { time: "9:00 – 9:20 pm", text: "Reading", habitId: "read" },
      { time: "9:30 – 10:00 pm", text: "YouTube / Idea panel", habitId: "yt" },
      { time: "10:00 – 10:20 pm", text: "Prayer", habitId: "pray" },
      { time: "10:20 – 11:00 pm", text: "Meditation / Scripting", habitId: "meditation" },
      { time: "11:00 pm – 6:00 am", text: "Sleep" }
    ];

    function renderSchedule() {
      scheduleListEl.innerHTML = "";
      scheduleBlocks.forEach(block => {
        const row = document.createElement("div");
        row.className = "schedule-row";

        const left = document.createElement("div");
        left.className = "schedule-time";
        left.textContent = block.time;

        const right = document.createElement("div");
        right.className = "schedule-task";

        if (block.habitId) {
          const habit = habits.find(h => h.id === block.habitId);
          right.textContent = habit ? habit.name : block.text;
        } else {
          right.textContent = block.text;
        }

        row.appendChild(left);
        row.appendChild(right);
        scheduleListEl.appendChild(row);
      });
    }

    // --- Render Habits ---
    function renderHabits() {
      habitListEl.innerHTML = "";
      if (habits.length === 0) {
        habitListEl.innerHTML =
          '<div class="card-subtitle">No habits yet. Add your first habit below.</div>';
        habitCountPill.textContent = "0 habits";
        return;
      }

      habits.forEach((habit) => {
        const row = document.createElement("div");
        row.className = "habit-item";

        const main = document.createElement("div");
        main.className = "habit-main";

        const bar = document.createElement("div");
        bar.className = "habit-color";

        const textBox = document.createElement("div");
        const nameEl = document.createElement("div");
        nameEl.className = "habit-name";
        nameEl.textContent = habit.name;
        const metaEl = document.createElement("div");
        metaEl.className = "habit-meta";
        metaEl.textContent = "1x per day";

        textBox.appendChild(nameEl);
        textBox.appendChild(metaEl);

        main.appendChild(bar);
        main.appendChild(textBox);

        const actions = document.createElement("div");
        actions.className = "habit-actions";

        const renameBtn = document.createElement("button");
        renameBtn.className = "secondary small";
        renameBtn.textContent = "Rename";
        renameBtn.onclick = () => {
          const newName = prompt("New name:", habit.name);
          if (newName && newName.trim()) {
            habit.name = newName.trim();
            saveHabits(habits);
            renderHabits();
            renderToday();
            renderSchedule();
          }
        };

        const deleteBtn = document.createElement("button");
        deleteBtn.className = "danger small";
        deleteBtn.textContent = "Delete";
        deleteBtn.onclick = () => {
          if (!confirm(`Delete habit "${habit.name}"?`)) return;
          habits = habits.filter((h) => h.id !== habit.id);
          saveHabits(habits);
          // Clean data
          const dateKeys = Object.keys(data);
          dateKeys.forEach((k) => {
            if (data[k] && data[k][habit.id] !== undefined) {
              delete data[k][habit.id];
            }
          });
          saveData(data);
          renderHabits();
          renderToday();
          renderHistory();
          renderWeekStrip();
          updateStreaks();
          renderSchedule();
        };

        actions.appendChild(renameBtn);
        actions.appendChild(deleteBtn);

        row.appendChild(main);
        row.appendChild(actions);
        habitListEl.appendChild(row);
      });

      habitCountPill.textContent =
        habits.length === 1 ? "1 habit" : `${habits.length} habits`;
    }

    // --- Today Checklist ---
    function renderToday() {
      const key = formatDateKey(currentDate);
      const dayData = data[key] || {};

      todayListEl.innerHTML = "";

      if (habits.length === 0) {
        todayListEl.innerHTML =
          '<div class="card-subtitle">No habits configured. Add habits on the left to start tracking.</div>';
      } else {
        habits.forEach((habit) => {
          const row = document.createElement("div");
          row.className = "today-row";

          const main = document.createElement("div");
          main.className = "today-main";

          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.checked = !!dayData[habit.id];
          checkbox.onchange = () => {
            const newDayData = { ...(data[key] || {}) };
            newDayData[habit.id] = checkbox.checked;
            data[key] = newDayData;
            saveData(data);
            updateProgress();
            renderHistory();
            renderWeekStrip();
            updateStreaks();
          };

          const label = document.createElement("label");
          label.textContent = habit.name;

          const status = document.createElement("div");
          status.className = "today-status";
          status.textContent = checkbox.checked ? "Done" : "Pending";

          checkbox.addEventListener("change", () => {
            status.textContent = checkbox.checked ? "Done" : "Pending";
          });

          main.appendChild(checkbox);
          main.appendChild(label);
          row.appendChild(main);
          row.appendChild(status);
          todayListEl.appendChild(row);
        });
      }

      if (isToday(currentDate)) {
        todaySubtitleEl.textContent = "Mark what you completed today.";
      } else {
        todaySubtitleEl.textContent =
          "Viewing a past day. You can still adjust completion.";
      }

      updateProgress();
    }

    // --- Progress & Summary ---
    function updateProgress() {
      const key = formatDateKey(currentDate);
      const dayData = data[key] || {};

      const total = habits.length;
      const completed = habits.filter((h) => dayData[h.id]).length;
      const pending = total - completed;

      const percent = total === 0 ? 0 : Math.round((completed / total) * 100);
      const circumference = 2 * Math.PI * 26;
      const offset = circumference - (percent / 100) * circumference;
      progressCircle.style.strokeDasharray = circumference.toFixed(2);
      progressCircle.style.strokeDashoffset = offset.toFixed(2);

      progressText.textContent = `${percent}%`;

      if (total === 0) {
        progressHeadline.textContent = "No habits set yet.";
        progressDetail.textContent = "Create habits on the left to begin tracking.";
      } else if (percent === 0) {
        progressHeadline.textContent = "Let’s get started.";
        progressDetail.textContent = "Even one small action today counts.";
      } else if (percent < 100) {
        progressHeadline.textContent = "Good progress.";
        progressDetail.textContent = `You’ve completed ${completed} of ${total} habits.`;
      } else {
        progressHeadline.textContent = "Perfect day!";
        progressDetail.textContent = "All habits completed. Lock in the streak.";
      }

      badgeHabits.textContent = total === 1 ? "1 habit" : `${total} habits`;
      badgeCompleted.textContent = `${completed} done`;
      badgePending.textContent = `${pending} pending`;

      if (percent === 100) {
        badgeCompleted.classList.add("good");
      } else {
        badgeCompleted.classList.remove("good");
      }
    }

    // --- History (last few logged days) ---
    function renderHistory() {
      historyListEl.innerHTML = "";

      const keys = Object.keys(data).sort().reverse(); // latest first
      const recent = keys.slice(0, 7);

      if (recent.length === 0) {
        historyListEl.innerHTML =
          '<div class="card-subtitle">No history yet. As you track, you’ll see recent days here.</div>';
        return;
      }

      recent.forEach((key) => {
        const dayData = data[key];
        const date = new Date(key + "T00:00:00");
        const total = habits.length;
        let completed = 0;
        if (dayData && total > 0) {
          completed = habits.filter((h) => dayData[h.id]).length;
        }
        const percent = total === 0 ? 0 : Math.round((completed / total) * 100);

        const row = document.createElement("div");
        row.className = "history-row";

        const left = document.createElement("div");
        left.textContent = formatDateLabel(date);

        const right = document.createElement("div");
        right.textContent = total
          ? `${completed}/${total} (${percent}%)`
          : "No habits";
        right.className = "muted";

        row.appendChild(left);
        row.appendChild(right);

        historyListEl.appendChild(row);
      });
    }

    // --- Weekly strip (last 7 calendar days from today) ---
    function renderWeekStrip() {
      weekStripEl.innerHTML = "";

      const today = new Date();
      for (let i = 6; i >= 0; i--) {
        const d = new Date(today.getFullYear(), today.getMonth(), today.getDate() - i);
        const key = formatDateKey(d);
        const dayData = data[key] || {};
        const total = habits.length;
        const completed = total ? habits.filter(h => dayData[h.id]).length : 0;
        const percent = total === 0 ? 0 : Math.round((completed / total) * 100);

        const dot = document.createElement("div");
        dot.className = "week-dot";

        if (percent === 0) {
          // keep default style
        } else if (percent < 70) {
          dot.classList.add("week-low");
        } else if (percent < 100) {
          dot.classList.add("week-mid");
        } else {
          dot.classList.add("week-high");
        }

        const label = document.createElement("div");
        label.textContent = d.toLocaleDateString(undefined, { weekday: "short" });

        const pct = document.createElement("span");
        pct.className = "percent";
        pct.textContent = `${percent}%`;

        dot.appendChild(label);
        dot.appendChild(pct);
        weekStripEl.appendChild(dot);
      }
    }

    // --- Streaks ---
    function isFullSuccess(date) {
      if (habits.length === 0) return false;
      const key = formatDateKey(date);
      const dayData = data[key];
      if (!dayData) return false;
      const completed = habits.filter(h => dayData[h.id]).length;
      return completed === habits.length && habits.length > 0;
    }

    function updateStreaks() {
      const keys = Object.keys(data);
      if (keys.length === 0 || habits.length === 0) {
        currentStreakBadge.textContent = "Current streak: 0 days";
        bestStreakBadge.textContent = "Best streak: 0 days";
        currentStreakBadge.classList.remove("good");
        bestStreakBadge.classList.remove("good");
        return;
      }

      // Current streak: from today backwards until a failure day
      let currentStreak = 0;
      let d = new Date();
      while (true) {
        if (isFullSuccess(d)) {
          currentStreak++;
          d = new Date(d.getFullYear(), d.getMonth(), d.getDate() - 1);
        } else {
          break;
        }
      }

      // Best streak: iterate calendar days between min and max date in data
      const sortedKeys = keys.sort();
      const minDate = new Date(sortedKeys[0] + "T00:00:00");
      const maxDate = new Date(sortedKeys[sortedKeys.length - 1] + "T00:00:00");
      let best = 0;
      let streak = 0;
      let cursor = new Date(minDate);
      while (cursor <= maxDate) {
        if (isFullSuccess(cursor)) {
          streak++;
          if (streak > best) best = streak;
        } else {
          streak = 0;
        }
        cursor = new Date(cursor.getFullYear(), cursor.getMonth(), cursor.getDate() + 1);
      }

      currentStreakBadge.textContent = `Current streak: ${currentStreak} day${currentStreak === 1 ? "" : "s"}`;
      bestStreakBadge.textContent = `Best streak: ${best} day${best === 1 ? "" : "s"}`;

      if (currentStreak >= 3) {
        currentStreakBadge.classList.add("good");
      } else {
        currentStreakBadge.classList.remove("good");
      }

      if (best >= 7) {
        bestStreakBadge.classList.add("good");
      } else {
        bestStreakBadge.classList.remove("good");
      }
    }

    // --- Date handling ---
    function initDate() {
      const key = formatDateKey(currentDate);
      dateInput.value = key;
      renderToday();
      renderHistory();
      renderWeekStrip();
      updateStreaks();
    }

    dateInput.addEventListener("change", () => {
      const value = dateInput.value;
      if (!value) return;
      const [year, month, day] = value.split("-").map(Number);
      currentDate = new Date(year, month - 1, day);
      renderToday();
      renderHistory();
      renderWeekStrip();
      updateStreaks();
    });

    // --- Add Habit ---
    addHabitForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const name = habitNameInput.value.trim();
      if (!name) return;

      const idBase = name
        .toLowerCase()
        .replace(/[^a-z0-9]+/g, "_")
        .replace(/^_+|_+$/g, "");
      let finalId = idBase || `habit_${Date.now()}`;
      let counter = 1;
      while (habits.find((h) => h.id === finalId)) {
        finalId = `${idBase}_${counter++}`;
      }

      habits.push({ id: finalId, name });
      saveHabits(habits);
      habitNameInput.value = "";
      renderHabits();
      renderToday();
      renderHistory();
      renderWeekStrip();
      updateStreaks();
      renderSchedule();
    });

    // --- Reset everything ---
    resetDataBtn.addEventListener("click", () => {
      if (!confirm("This will delete ALL habits and tracking data. Are you sure?")) return;
      localStorage.removeItem(STORAGE_KEY_HABITS);
      localStorage.removeItem(STORAGE_KEY_DATA);
      habits = loadHabits();
      data = {};
      currentDate = new Date();
      dateInput.value = formatDateKey(currentDate);
      renderHabits();
      renderToday();
      renderHistory();
      renderWeekStrip();
      updateStreaks();
      renderSchedule();
    });

    // --- Init ---
    function init() {
      renderHabits();
      renderSchedule();
      initDate();
    }

    init();
  </script>
</body>
</html>
